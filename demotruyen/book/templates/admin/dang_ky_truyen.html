{% extends 'admin/home.html' %}

{% block content %}

<div class="container mt-5">
    <!-- Hiển thị thông báo -->
    {% if messages %}
        <div class="mt-3">
            {% for message in messages %}
                <div class="alert {% if message.tags == 'success' %}alert-success{% else %}alert-danger{% endif %} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}
        </div>
    {% endif %}
    <h2 class="text-center" style="margin-top:75px">Đăng Ký Truyện</h2>
    <form method="POST" enctype="multipart/form-data" id="truyenForm" class="needs-validation" novalidate>
        {% csrf_token %}

        <!-- Tên truyện -->
        <div class="mb-3">
            <label for="ten_truyen" class="form-label">Tên Truyện:</label>
            <input type="text" class="form-control" id="ten_truyen" name="ten_truyen" required>
            <div class="invalid-feedback">Vui lòng nhập tên truyện.</div>
        </div>

        <!-- Tên tác giả (tự động lấy từ người dùng đăng nhập) -->
        <div class="mb-3">
            <label for="ten_tac_gia" class="form-label">Tên Tác Giả:</label>
            <input type="text" class="form-control" id="ten_tac_gia" value="{{ user.thong_tin_nguoi_dung.ten_hien_thi }}" readonly><!--readonly: Không cho phép người dùng chỉnh sửa giá trị của trường nhập liệu.-->
        </div>

        <!-- Ảnh đại diện -->
        <div class="mb-3">
            <label for="anh_dai_dien" class="form-label">Ảnh Đại Diện:</label>
            <input type="file" class="form-control" id="anh_dai_dien" name="anh_dai_dien" >
        </div>

        <!-- Thể loại -->
        <div class="mb-3">
            <label class="form-label">Thể Loại:</label>
            <div class="row">
            {% for theloai in the_loais %}
            <div class="col-md-3">
            <div class="form-check">
                <input class="form-check-input" type="checkbox" name="the_loai" value="{{ theloai.id }}" id="theloai{{ theloai.id }}">
                <label class="form-check-label" for="theloai{{ theloai.id }}">
                    {{ theloai.ten_the_loai }}
                </label>
            </div>
        </div>
        {% endfor %}
        </div>
            <div class="invalid-feedback">Vui lòng chọn ít nhất một thể loại.</div>
        </div>

        <!-- Trạng thái -->
        <div class="mb-3">
            <label for="trang_thai" class="form-label">Trạng Thái:</label>
            <select class="form-select" id="trang_thai" name="trang_thai" >
                <option value="dang_ra">Đang ra</option>
                <option value="hoan_thanh">Hoàn thành</option>
                <option value="tam_ngung">Tạm ngừng</option>
            </select>
        </div>

        <!-- Giới thiệu truyện -->
        <div class="mb-3">
            <label for="gioi_thieu" class="form-label">Giới Thiệu:</label>
            <textarea class="form-control" id="gioi_thieu" name="gioi_thieu" rows="3" ></textarea>
            <div class="invalid-feedback">Vui lòng nhập giới thiệu truyện.</div>
        </div>

        <!-- Số chương -->
        <div class="mb-3">
            <label for="so_chuong" class="form-label">Số Chương:</label>
            <input type="number" class="form-control" id="so_chuong" name="so_chuong" min="1" required>
            <div class="invalid-feedback">Vui lòng nhập số chương hợp lệ.</div>
        </div>

        <!-- Khu vực nhập chương -->
        <div id="chuongContainer"></div>

        <!-- Submit -->
        <button type="submit" class="btn btn-primary ">Đăng Ký</button>
    </form>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    let soChuongInput = document.getElementById("so_chuong");
    let chuongContainer = document.getElementById("chuongContainer");

    soChuongInput.addEventListener("input", function() {
        chuongContainer.innerHTML = ""; // Xóa các form cũ
        let soChuong = parseInt(this.value);

        if (soChuong > 0) {
            for (let i = 1; i <= soChuong; i++) {
                let chuongDiv = document.createElement("div");
                chuongDiv.classList.add("mb-3");

                chuongDiv.innerHTML = `
                    <label class="form-label">Chương ${i}</label>
                     <input type="text" class="form-control ten-chuong" name="ten_chuong_${i}" placeholder="Tên chương" required>
                    <textarea class="form-control noi-dung-chuong mt-2" name="noi_dung_chuong_${i}" placeholder="Nội dung chương" required></textarea>
                    
                `;
                chuongContainer.appendChild(chuongDiv);
            }
        }
    });

    // Kiểm tra form validation trước khi submit
    document.getElementById("truyenForm").addEventListener("submit", function(event) {
        if (!this.checkValidity()) {
            event.preventDefault();
            event.stopPropagation();
        }
        this.classList.add("was-validated");
    });
});
</script>
<style>
    /* Input field for chapter title */
    .ten-chuong {
        width: 100%; /* or a fixed width like 400px */
        max-width: 1200px; /* limit max width for large screens */
        height: 44px; /* standard height for single line */
        padding: 0.5rem; /* padding for comfort */
        font-size: 1rem; /* font size */
        border: 1px solid #d1d5db; /* light gray border */
        border-radius: 0.5rem; /* rounded corners */
        transition: border-color 0.3s ease; /* smooth transition */
    }
    .ten-chuong:focus {
        border-color: #2563eb; /* blue focus border */
        outline: none; /* remove default outline */
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.3); /* subtle shadow */
    }
    /* Textarea for chapter content with fixed 500px height */
    .noi-dung-chuong {
        width: 100%; /* or a fixed width like 400px */
        max-width: 1200px; /* limit max width for large screens */
        height: 1000px; /* fixed height for multi-line input */
        padding: 0.75rem; /* padding for comfort */
        font-size: 1rem; /* font size */
        border: 1px solid #d1d5db; /* light gray border */
        border-radius: 0.5rem; /* rounded corners */
        resize: none; /* disable resizing */
        transition: border-color 0.3s ease; /* smooth transition */
    }
    .noi-dung-chuong:focus {
        border-color: #2563eb; /* blue focus border */
        outline: none; /* remove default outline */
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.3); /* subtle shadow */
    }
</style>

{% endblock %}