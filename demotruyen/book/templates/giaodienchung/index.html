{% load static %}
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>MonkeyD - Truyện Online</title>
    <link rel="stylesheet" href="{% static 'bootstrap-5.3.5-dist/css/bootstrap.min.css' %}">
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>

    
    <link rel="stylesheet" href="{% static 'static/style.css' %}"> 
    <style>
        /* Chế độ sáng/tối */
        :root {
            --background-light: #ffffff;
            --background-dark: #181818;
            --text-light: #000;
            --text-dark: #fff;
            --navbar-light: #ffffff;
            --navbar-dark: #222;
            --toggle-light: #f8f9fa; /* Màu nền sáng cho toggle */
        }

        body {
            background-color: var(--background-light);
            color: var(--text-light);
            transition: background 0.3s ease, color 0.3s ease;
        }

        .dark-mode  {
            background-color: var(--background-dark);
            color: var(--text-dark);
        }

        .dark-mode .navbar, .dark-mode .bg-white {
            background-color: var(--navbar-dark) !important;
            color: var(--text-dark) !important;
        }

        /* Đổi màu chữ của các item trong menu */
        .dark-mode .navbar-menu .nav-item a {
            color: var(--text-dark) !important; /* Màu chữ sáng Dùng !important để đảm bảo CSS này được ưu tiên hơn các CSS khác */
        }
        
        /* Đổi màu khi hover trong dark mode */
        .dark-mode .navbar-menu .nav-item a:hover {
            background-color: rgba(255, 255, 255, 0.1) !important; /* Màu sáng hơn một chút */
            border-radius: 5px;
        }

        /* Giữ toggle menu sáng khi ở chế độ tối */
        .dark-mode .navbar-toggler {
            background-color: var(--toggle-dark) !important;
            color: var(--text-light) !important;
            border: 2px solid #ccc; /* Đảm bảo viền rõ ràng */
        }

        


        /* Đổi màu dropdown menu trong dark mode */
        .dark-mode .dropdown-menu {
            background-color: #333 !important; /* Màu nền tối */
            border: 1px solid #444; /* Viền cho rõ hơn */
        }
        
        .dark-mode .dropdown-menu .dropdown-item {
            color: #fff !important; /* Màu chữ sáng */
        }
        
        .dark-mode .dropdown-menu .dropdown-item:hover {
            background-color: #555 !important; /* Hiệu ứng hover */
        }




        /* Dark mode cho ô nhập */
        .dark-mode input.form-control {
            background-color: #222 !important; /* Màu nền tối */
            color: #fff !important; /* Màu chữ trắng */
            border: 1px solid #555 !important; /* Viền xám */
        }
        
        /* Placeholder cũng dễ đọc hơn */
        .dark-mode input.form-control::placeholder {
            color: #aaa !important; /* Màu chữ placeholder xám nhạt */
        }



        /* Đổi màu nền của card bộ lọc */
        .dark-mode .card {
            background-color: #222 !important; 
            color: #fff !important; 
            border: 1px solid #444; 
        }
        
        .dark-mode .card-body {
            color: #fff !important; /* Đổi màu chữ sang trắng */
        }
        
        /* Đổi màu cho các đoạn chữ nhỏ */
        .dark-mode .card-body p {
            color: #bbb !important; /* Màu xám nhẹ để dễ nhìn */
        }
        
        
        /* Dark mode cho pagination */
        .dark-mode .pagination {
            background-color: #222; /* Màu nền tối */
            padding: 8px;
            border-radius: 5px;
        }
        
        /* Màu chữ và nền các item */
        .dark-mode .page-item .page-link {
            color: #ddd !important; /* Chữ sáng */
            background-color: #333 !important; /* Nền tối */
            border: 1px solid #444 !important;
        }
        
        /* Hover effect */
        .dark-mode .page-item .page-link:hover {
            background-color: #555 !important;
            color: #fff !important;
        }
        
        /* Active page */
        .dark-mode .page-item.active .page-link {
            background-color: #007bff !important; /* Xanh đậm */
            color: #fff !important;
            border-color: #0056b3 !important;
        }
        
        /* Vô hiệu hóa */
        .dark-mode .page-item.disabled .page-link {
            color: #666 !important;
            background-color: #222 !important;
            border-color: #333 !important;
            cursor: not-allowed;
        }
        
        


        /* Header trên cùng */
        .top-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 20px;
        }

        .search-box {
            width: 300px;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding-left: 35px;
            border-radius: 20px;
        }

        .search-box i {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: gray;
        }

        /* Thanh menu */
        .navbar-menu {
            background-color: #f8f9fa;
            box-shadow: 0px 3px 5px rgba(0, 0, 0, 0.1);
        }

        .navbar-menu .nav-item a {
            font-weight: 500;
            padding: 12px 15px;
            display: flex;
            align-items: center;
        }

        .navbar-menu .nav-item a i {
            margin-right: 5px;
        }

        /* Hiệu ứng hover */
        .navbar-menu .nav-item a:hover {
            background-color: rgba(0, 0, 0, 0.05);
            border-radius: 5px;
        }

        /* Hiệu ứng trueyn moi cap nhat */
        .card.truyen-card {
            height: 100%; /* Giữ chiều cao đồng nhất */
            display: flex;
            flex-direction: column;
        }
        .truyen-card {
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease-in-out;
          }
          .truyen-card:hover {
            transform: scale(1.05);
          }
          .truyen-img {
            width: 100%;
            height: 200px;
            object-fit: cover;
          }
          .pagination .page-item.active .page-link {
            background-color: #007bff;
            border-color: #007bff;
          }
          
          .card.truyen-card .card-body {
            flex-grow: 1; /* Tự động co giãn */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
          }
          
          .card.truyen-card img {
            height: 280px; /* Đặt chiều cao cố định cho ảnh */
            object-fit: cover; /* Cắt ảnh để vừa khung */
          }
          
          .card-body .card-title {
            font-size: 18px;
            font-weight: bold;
            text-align: left;
            white-space: normal; /* Cho phép xuống dòng */
            overflow: hidden;
            text-overflow: ellipsis; /* Ngăn chữ bị tràn ...... */
            display: -webkit-box;
            -webkit-line-clamp: 2; /* Giới hạn tối đa 2 dòng */
            -webkit-box-orient: vertical;
            line-height: 1.4; /* Tăng line-height để chữ không bị cắt */
            margin-bottom: 3;
          }
          .card-body p {
            font-size: 14px; /* Mặc định cho desktop */
          }
          
          /* Chỉnh nhỏ hơn trên điện thoại */
          @media (max-width: 768px) {
            .card-title {
                font-size: 18px; /* Giảm kích thước chữ trên điện thoại */
                -webkit-line-clamp: 2 ; /* Giới hạn hiển thị tối đa 2 dòng */
                -webkit-box-orient: vertical;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: normal;
                margin-bottom:5 ;
            }
          
            .card.truyen-card img {
                height: 200px; /* Đặt chiều cao cố định cho ảnh */
                object-fit: cover; /* Cắt ảnh để vừa khung */
            }
          
            .card-body p {
                font-size: 12px; /* Chương & ngày nhỏ hơn trên điện thoại */
            }
          }
          .search-box {
            position: relative;
            width: 50%;
        }
    
        .search-box .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 16px;
            color: gray;
        }
    
        .search-box input {
            padding-left: 40px; /* Chừa khoảng trống để icon không bị đè */
            height: 42px;
            font-size: 16px;
        }
          

        
        
    </style>
</head>
<body>
    {% if thong_bao %}
    <div class="alert alert-warning text-center">
        {{ thong_bao }}
    </div>
    {% endif %}


        <!-- Header trên cùng -->
<nav class="navbar navbar-expand-lg navbar-light bg-white">
    <div class="container">
        <!-- Logo -->
        <a class="navbar-brand fs-4 fw-bold text-primary" href="#">🦄💕FunnyStory</a>

        <!-- Nút Toggle (Hiện trên màn hình nhỏ) -->
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
            <span class="navbar-toggler-icon"></span>
        </button>

        <!-- Nội dung menu -->
        <div class="collapse navbar-collapse justify-content-between" id="navbarContent">
            <!-- Tìm kiếm (Ẩn trên mobile) -->
            <div class="search-box mx-auto my-3 w-100">
                <i class="fas fa-search search-icon"></i> <!-- Icon kính lúp -->
                <form action="{% url 'tim_kiem_truyen' %}" method="GET">
                    <input class="form-control form-control-sm rounded-pill shadow-sm" 
                           type="search" name="q" placeholder="Tìm truyện..." 
                           aria-label="Search" required>
                </form>
            </div>
            

            

            <!-- Nút Sáng/Tối và Đăng nhập -->
            <div class="d-flex flex-wrap justify-content-center align-items-center gap-2 w-100 text-center">
                <button id="toggleTheme" class="btn btn-outline-secondary">
                    <i class="fas fa-moon"></i>
                </button>
                <a href="{% url 'login' %}" class="btn btn-primary ">Đăng nhập</a>
                <a href="{% url 'register' %}" class="btn btn-primary ">Đăng ký</a>
                
            </div>
    
        </div> 
    </div>
</nav>


<div class="offcanvas offcanvas-start" data-bs-scroll="true" tabindex="-1" id="offcanvasWithBothOptions" aria-labelledby="offcanvasWithBothOptionsLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="offcanvasWithBothOptionsLabel">Backdrop with scrolling</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
      <p>Try scrolling the rest of the page to see this option in action.</p>
    </div>
  </div>


    <!-- Thanh menu chính -->
    <nav class="navbar navbar-expand-lg navbar-light navbar-menu mt-2">
        <div class="container">
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-center" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item me-3"><a class="nav-link" href="{% url 'home' %}"><i class="fas fa-home"></i> Trang chủ</a></li>
                    <li class="nav-item me-3"><a class="nav-link" href="#"><i class="fas fa-book"></i> Truyện mới</a></li>
                    
                    <li class="nav-item dropdown me-3">
                        <a class="nav-link dropdown-toggle" href="#" id="dropdownTheLoai" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-list"></i> Thể loại
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="dropdownTheLoai">
                            {% if theloais %}
                                {% for theloai in theloais %}
                                    <li><a class="dropdown-item" href="{% url 'the_loai' theloai.id %}">{{ theloai.ten_the_loai }}</a></li>
                                {% endfor %}
                            {% else %}
                                <li><a class="dropdown-item disabled">Không có thể loại nào</a></li>
                            {% endif %}
                        </ul>
                    </li>
                    
                    
                    <li class="nav-item me-3"><a class="nav-link" href="#"><i class="fas fa-check-circle"></i> Truyện Full</a></li>
                    <li class="nav-item me-3"><a class="nav-link" href="#"><i class="fas fa-book-open"></i> Truyện Dài</a></li>
                    <li class="nav-item me-3"><a class="nav-link" href="#"><i class="fas fa-star"></i> Truyện Sáng Tác</a></li>
                    <li class="nav-item me-3"><a class="nav-link" href="#"><i class="fas fa-users"></i> Team</a></li>
                    <li class="nav-item me-3"><a class="nav-link" href="#"><i class="fas fa-headphones"></i> Nghe Audio</a></li>
                </ul>
            </div>
        </div>
        
    </nav>

{%block content %} <!--Django cho phép bạn kế thừa template bằng cách dùng ... để ghi đè nội dung trong trang con.-->
        
    <div class="container mt-4">
        <h2 class="mb-4">TRUYỆN MỚI CẬP NHẬT</h2>
        
        <div class="row">
            {% for truyen in page_obj %}
            
            <div class="col-6 col-md-4 col-lg-3 mb-4" >
                 <!-- Bọc toàn bộ card trong thẻ <a> -->
                <a href="{% url 'chitiettruyen' truyen.id %}" class="text-decoration-none">
                
                 <!-- Điều chỉnh số cột theo kích thước màn hình -->
                <div class="card truyen-card h-100">
                    
                    <div class="position-relative">
                        
                        <img src="{{ truyen.anh_dai_dien.url }}" class="truyen-img card-img-top" alt="{{ truyen.ten_truyen }}">
                        
                        {% if truyen.trang_thai == 'Full' %}
                        <span class="badge bg-danger position-absolute top-0 end-0">FULL</span>
                        {% endif %}
                    </div>
                    <div class="card-body d-flex flex-column justify-content-between">
                        <h6 class="card-title text-truncate">{{ truyen.ten_truyen }}</h6>
                        <p class="text-muted mt-3 mb-1 small">📖 Chương: {{ truyen.so_luong_chuong }}</p>
                        <p class="text-muted small">📅 Cập nhật: {{ truyen.ngay_cap_nhat|date:"d/m/Y" }}</p>
                    </div>
                </div>
                </a>
            </div>
            {% empty %}
            <p>Không có truyện nào.</p>
            {% endfor %}
        </div>

    </div>

    {% endblock %} <!--Đưa tất cả nội dung vào ... để trang con có thể ghi đè hoàn toàn nội dung.-->
        

        <!-- Phân trang --> <!--MẤY TRANG KẾ THỪA KO CẦN KHAI BÁO-->
        <nav aria-label="Page navigation">
            <ul class="pagination justify-content-center">
                {% if page_obj.has_previous %}
                    <li class="page-item">
                        <a class="page-link" href="?page=1">&laquo;</a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" href="?page={{ page_obj.previous_page_number }}">‹</a>
                    </li>
                {% endif %}
    
                {% for num in page_obj.paginator.page_range %}
                    {% if page_obj.number == num %}
                        <li class="page-item active"><span class="page-link">{{ num }}</span></li>
                    {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                        <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
                    {% endif %}
                {% endfor %}
    
                {% if page_obj.has_next %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ page_obj.next_page_number }}">›</a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}">&raquo;</a>
                    </li>
                {% endif %}
            </ul>
        </nav>
    
    <div class="container mt-4">
        <h2 class="mb-4">🔥 Truyện được yêu thích nhất</h2>
        
        <div class="row">
            {% for truyen in top_truyen_thich%}
            
            <div class="col-6 col-md-4 col-lg-3 mb-4" >
                 <!-- Bọc toàn bộ card trong thẻ <a> -->
                <a href="{% url 'chitiettruyen' truyen.id %}" class="text-decoration-none">
                
                 <!-- Điều chỉnh số cột theo kích thước màn hình -->
                <div class="card truyen-card h-100">
                    
                    <div class="position-relative">
                        
                        <img src="{{ truyen.anh_dai_dien.url }}" class="truyen-img card-img-top" alt="{{ truyen.ten_truyen }}">
                        
                        {% if truyen.trang_thai == 'Full' %}
                        <span class="badge bg-danger position-absolute top-0 end-0">FULL</span>
                        {% endif %}
                    </div>
                    <div class="card-body d-flex flex-column justify-content-between">
                        <h6 class="card-title text-truncate">{{ truyen.ten_truyen }}</h6>
                        <p class="text-muted mt-3 mb-1 small">📖 Chương: {{ truyen.so_luong_chuong }}</p>
                        <p class="text-muted small">📅 Cập nhật: {{ truyen.ngay_cap_nhat|date:"d/m/Y" }}</p>
                    </div>
                </div>
                </a>
            </div>
            {% empty %}
            <p>Không có truyện nào.</p>
            {% endfor %}
        </div>

    </div>

    <div class="container mt-4">
        <h2 class="mb-4">🔥 Truyện được theo dõi nhiều nhất</h2>
        
        <div class="row">
            {% for truyen in top_truyen_yeu_thich%}
            
            <div class="col-6 col-md-4 col-lg-3 mb-4" >
                 <!-- Bọc toàn bộ card trong thẻ <a> -->
                <a href="{% url 'chitiettruyen' truyen.id %}" class="text-decoration-none">
                
                 <!-- Điều chỉnh số cột theo kích thước màn hình -->
                <div class="card truyen-card h-100">
                    
                    <div class="position-relative">
                        
                        <img src="{{ truyen.anh_dai_dien.url }}" class="truyen-img card-img-top" alt="{{ truyen.ten_truyen }}">
                        
                        {% if truyen.trang_thai == 'Full' %}
                        <span class="badge bg-danger position-absolute top-0 end-0">FULL</span>
                        {% endif %}
                    </div>
                    <div class="card-body d-flex flex-column justify-content-between">
                        <h6 class="card-title text-truncate">{{ truyen.ten_truyen }}</h6>
                        <p class="text-muted mt-3 mb-1 small">📖 Chương: {{ truyen.so_luong_chuong }}</p>
                        <p class="text-muted small">📅 Cập nhật: {{ truyen.ngay_cap_nhat|date:"d/m/Y" }}</p>
                    </div>
                </div>
                </a>
            </div>
            {% empty %}
            <p>Không có truyện nào.</p>
            {% endfor %}
        </div>

    </div>



    <!-- JavaScript -->
    <script>
        document.getElementById("toggleTheme").addEventListener("click", function () {
            document.body.classList.toggle("dark-mode");
            let icon = this.querySelector("i");

            if (document.body.classList.contains("dark-mode")) {
                icon.classList.remove("fa-moon");
                icon.classList.add("fa-sun");
            } else {
                icon.classList.remove("fa-sun");
                icon.classList.add("fa-moon");
            }
        });

        document.addEventListener("DOMContentLoaded", function () {
            let form = document.getElementById("searchForm");
            let input = document.getElementById("searchInput");
    
            form.addEventListener("submit", function (e) {
                if (!input.value.trim()) {  // Nếu input rỗng
                    e.preventDefault();  // Ngăn gửi form
                    alert("Vui lòng nhập từ khóa tìm kiếm!");
                }
            });
        });
           
        
        
        
    </script>
    <script src="{% static 'bootstrap-5.3.5-dist/js/bootstrap.bundle.min.js' %}"></script>
    <!--<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.min.js" integrity="sha384-VQqxDN0EQCkWoxt/0vsQvZswzTHUVOImccYmSyhJTp7kGtPed0Qcx8rK9h9YEgx+" crossorigin="anonymous"></script>-->
       

    
    
</body>
</html>
